<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Tip Split App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f6f7f9;
      --card: #ffffff;
      --primary: #2563eb;
      --border: #e5e7eb;
      --text: #111827;
      --muted: #6b7280;
      --radius: 14px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .container {
      max-width: 960px;
      margin: auto;
      padding: 24px 16px 60px;
    }

    h1 { font-size: 26px; margin-bottom: 6px; }
    h2 { font-size: 18px; margin-bottom: 12px; }

    .sub {
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 16px;
    }

    button {
      border: none;
      background: var(--primary);
      color: white;
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
    }

    button.secondary {
      background: #e5e7eb;
      color: #111;
    }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 14px;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      border: 1px solid var(--border);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 8px;
    }

    .result {
      background: #f9fafb;
      border-radius: 10px;
      padding: 12px;
      margin-top: 10px;
    }

    .result ul {
      padding-left: 18px;
      margin: 6px 0;
    }

    .result li {
      font-size: 14px;
      margin-bottom: 4px;
    }

    .footer-note {
      font-size: 12px;
      color: var(--muted);
      margin-top: 20px;
      text-align: center;
    }

    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 32px 0;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>üí∞ Tip Split</h1>
  <div class="sub">Î°úÏª¨ Í≥ÑÏÇ∞ ¬∑ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏóÜÏùå</div>

  <button id="modeBtn">‚û° Weekend</button>

  <div class="card">
    <h2>üè¢ Floors</h2>
    <div id="floors"></div>
  </div>

  <div class="card">
    <h2>‚ûï Extra Tip</h2>
    <input type="number" id="extraTip" oninput="render()" />
  </div>

  <div class="card">
    <h2>üë• Tip Split Rules</h2>
    <div id="rules"></div>
  </div>

  <div class="card">
    <h2>üìä Result</h2>
    <div id="result"></div>
  </div>

  <hr />

  <div class="card">
    <h2>‚è±Ô∏è Hour-based Split</h2>

    <input type="number" id="hourAmount" placeholder="Total Amount" oninput="render()" />

    <div id="hourRows"></div>

    <button class="secondary" onclick="addHourRow()">+ Add Server</button>

    <div id="hourResult"></div>
  </div>

  <div class="footer-note">
    Ïù¥ Ïï±ÏùÄ Ïñ¥Îñ§ Îç∞Ïù¥ÌÑ∞ÎèÑ Ï†ÄÏû•ÌïòÍ±∞ÎÇò Ï†ÑÏÜ°ÌïòÏßÄ ÏïäÏäµÎãàÎã§.
  </div>
</div>

<script>
/* ======================
   State
====================== */
let mode = "weekday";

const emptyFloor = { cash: "", card: "" };
const floors = {
  1: { ...emptyFloor },
  2: { ...emptyFloor },
  3: { ...emptyFloor }
};

const defaultRows = [
  { percent: "", count: "" },
  { percent: "", count: "" },
  { percent: "", count: "" },
  { percent: "", count: "" }
];

let rowsWeekday = JSON.parse(JSON.stringify(defaultRows));
let rowsWeekend = {
  1: JSON.parse(JSON.stringify(defaultRows)),
  2: JSON.parse(JSON.stringify(defaultRows)),
  3: JSON.parse(JSON.stringify(defaultRows))
};

let hourRows = [
  { name: "", hours: "" },
  { name: "", hours: "" }
];

const n = v => Number(v || 0);

/* ======================
   Core logic
====================== */
function floorTotal(f) {
  return n(f.cash) + n(f.card) + (mode === "weekend" ? 25 : 0);
}

function cleanRows(rows) {
  return rows
    .map(r => ({
      percent: n(r.percent) / 100,
      count: Math.floor(n(r.count))
    }))
    .filter(r => r.percent > 0 && r.count > 0);
}

function splitTips({ totalTip, rows, addHost }) {
  if (totalTip <= 0) return null;

  let groups = cleanRows(rows);
  if (addHost) groups.push({ percent: 0.3, count: 1, isHost: true });

  const totalWeight = groups.reduce((s, g) => s + g.percent * g.count, 0);
  if (!totalWeight) return null;

  const base = totalTip / totalWeight;
  const baseFloor = Math.floor(base);

  const result = groups.map(g => {
    const oneTip =
      g.percent === 1
        ? Math.floor(base)
        : Math.floor(baseFloor * g.percent);

    return {
      percentLabel: `${Math.round(g.percent * 100)}%`,
      count: g.count,
      oneTip,
      total: oneTip * g.count,
      isHost: g.isHost
    };
  });

  const distributed = result.reduce((s, r) => s + r.total, 0);

  return {
    totalTip,
    base,
    result,
    leftover: totalTip - distributed
  };
}

/* ======================
   Render
====================== */
function render() {
  document.getElementById("modeBtn").innerText =
    mode === "weekday" ? "‚û° Weekend" : "‚û° Weekday";

  renderFloors();
  renderRules();
  renderResult();
  renderHour();
}

function renderFloors() {
  const div = document.getElementById("floors");
  div.innerHTML = "";

  const show = mode === "weekday" ? [1, 2] : [1, 2, 3];
  show.forEach(f => {
    div.innerHTML += `
      <div class="row">
        <input type="number" placeholder="${f}F Cash"
          value="${floors[f].cash}"
          oninput="floors[${f}].cash=this.value; render()" />
        <input type="number" placeholder="${f}F Card"
          value="${floors[f].card}"
          oninput="floors[${f}].card=this.value; render()" />
      </div>
    `;
  });
}

function renderRules() {
  const div = document.getElementById("rules");
  div.innerHTML = "";

  if (mode === "weekday") {
    div.innerHTML += "<b>Weekday</b>";
    renderRows(div, rowsWeekday, "rowsWeekday");
  } else {
    [1, 2, 3].forEach(f => {
      div.innerHTML += `<b>${f}F</b>`;
      renderRows(div, rowsWeekend[f], `rowsWeekend[${f}]`);
    });
  }
}

function renderRows(container, rows, path) {
  rows.forEach((r, i) => {
    container.innerHTML += `
      <div class="row">
        <input type="number" placeholder="%"
          value="${r.percent}"
          oninput="${path}[${i}].percent=this.value; render()" />
        <input type="number" placeholder="Count"
          value="${r.count}"
          oninput="${path}[${i}].count=this.value; render()" />
      </div>
    `;
  });
}

function renderResult() {
  const extra = n(document.getElementById("extraTip").value);
  let html = "";

  if (mode === "weekday") {
    const total =
      floorTotal(floors[1]) +
      floorTotal(floors[2]) +
      extra;

    const data = splitTips({
      totalTip: total,
      rows: rowsWeekday,
      addHost: false
    });

    if (data) html += resultBlock("Weekday", data);
  } else {
    [1, 2, 3].forEach(f => {
      const data = splitTips({
        totalTip: floorTotal(floors[f]) + (f === 1 ? extra : 0),
        rows: rowsWeekend[f],
        addHost: true
      });
      if (data) html += resultBlock(`${f}F`, data);
    });
  }

  document.getElementById("result").innerHTML = html;
}

function resultBlock(title, data) {
  return `
    <div class="result">
      <b>${title}</b><br/>
      Total: $${data.totalTip}<br/>
      Base: ${data.base.toFixed(4)}
      <ul>
        ${data.result.map(r =>
          `<li>${r.isHost ? "HOST " : ""}${r.percentLabel}
           ‚Üí $${r.oneTip} √ó ${r.count} = $${r.total}</li>`
        ).join("")}
      </ul>
      Leftover: $${data.leftover}
    </div>
  `;
}

/* ======================
   Hour split
====================== */
function addHourRow() {
  hourRows.push({ name: "", hours: "" });
  render();
}

function renderHour() {
  const div = document.getElementById("hourRows");
  div.innerHTML = "";

  hourRows.forEach((r, i) => {
    div.innerHTML += `
      <div class="row">
        <input placeholder="Name"
          value="${r.name}"
          oninput="hourRows[${i}].name=this.value; render()" />
        <input type="number" placeholder="Hours"
          value="${r.hours}"
          oninput="hourRows[${i}].hours=this.value; render()" />
      </div>
    `;
  });

  const total = n(document.getElementById("hourAmount").value);
  const clean = hourRows.filter(r => n(r.hours) > 0);
  if (!total || !clean.length) return;

  const totalHours = clean.reduce((s, r) => s + n(r.hours), 0);
  const perHour = total / totalHours;

  let distributed = 0;
  const result = clean.map(r => {
    const tip = Math.floor(n(r.hours) * perHour);
    distributed += tip;
    return { ...r, tip };
  });

  document.getElementById("hourResult").innerHTML = `
    <div class="result">
      Hour Rate: $${perHour.toFixed(2)}
      <ul>
        ${result.map(r =>
          `<li>${r.name || "Unnamed"} ‚Üí ${r.hours}h = $${r.tip}</li>`
        ).join("")}
      </ul>
      Leftover: $${total - distributed}
    </div>
  `;
}

/* ======================
   Init
====================== */
document.getElementById("modeBtn").onclick = () => {
  mode = mode === "weekday" ? "weekend" : "weekday";
  render();
};

render();
</script>

</body>
</html>
